---
title: æ‰€æœ‰å­åŒºé—´æœ€å€¼æ±‚å’Œ
author: uncleacc
avatar: >-
  https://dss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3616765171,3721318254&fm=26&gp=0.jpg
authorAbout: ä¸€ä¸ªå¥½å¥‡çš„äºº
authorDesc: ä¸€ä¸ªå¥½å¥‡çš„äºº
categories: ç®—æ³•
comments: true
photos: https://cdn.jsdelivr.net/gh/uncleacc/Img/textbg/57.webp
date: 2020-06-04 12:02:18
tags: æ•°æ®ç»“æ„
keywords:
description: æ±‚åŒºé—´å­åŒºé—´æœ€å€¼å’Œé—®é¢˜
---
>è¿™é“é¢˜ç”¨å•è°ƒæ ˆè§£å†³äº†ä¸€ä¸ªåŒºé—´çš„æ‰€æœ‰å­åŒºé—´æœ€å€¼ä¹‹å’Œçš„é—®é¢˜ï¼Œä»¥åå¦‚æœç¢°åˆ°ç±»è¯•é—®é¢˜å¯ä»¥ç›´æ¥å¥—ç”¨è¿™ä¸ªæ¨¡æ¿çš„

## é¢˜ç›®
![é¢˜ç›®](https://img-blog.csdnimg.cn/20200604120946815.png)
![é¢˜ç›®](https://img-blog.csdnimg.cn/20200604120946818.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0FHTklORw==,size_16,color_FFFFFF,t_70)
![é¢˜ç›®](https://img-blog.csdnimg.cn/20200604120946793.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0FHTklORw==,size_16,color_FFFFFF,t_70)

### é¢˜è§£
ä¸æ˜¯æˆ‘ä¸æƒ³å†™ï¼Œå› ä¸ºæˆ‘è§‰å¾—è‡ªå·±å†™çš„æ²¡æœ‰äººå®¶å¥½ğŸ˜‚å•çº¯è®°å½•ä¸€ä¸‹
[ä¸€ç¯‡å¾ˆè¯¦ç»†çš„é¢˜è§£](https://blog.csdn.net/Code92007/article/details/83689045?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase)
å¦‚æœä½ çœ‹å®Œäº†è¿™ç¯‡é¢˜è§£ï¼Œæˆ‘å°±å¼ºè°ƒä¸€ç‚¹å§ï¼Œå½“å¾€å·¦æ‰©å±•æˆ–è€…ç½‘å‹æ‰©å±•å…¶ä¸­ä¸€ä¸ªä¸€å®šä¸èƒ½æœ‰ç­‰äºå·ï¼Œå› ä¸ºå¦‚æœæ•°æ®ä¸­æœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªå€¼ç›¸åŒæ—¶ï¼Œå¦‚æœä½ éƒ½å†™æˆäº†å¤§äºç­‰äºï¼Œé‚£ä¹ˆç®—å‡ºçš„åŒºé—´å°±æ˜¯ä»¥è¯¥å€¼ä¸ºæœ€å¤§å€¼çš„ä¸¥æ ¼æ„ä¹‰ä¸Šçš„é‚£æ®µåŒºé—´ï¼Œæ¯”å¦‚ï¼š
6 5 5 4 8
å¦‚æœä½ éƒ½å†™æˆäº†å¤§äºç­‰äºï¼Œé‚£ä¹ˆæ•°æ®ä¸­ä¸¤ä¸ª5å¯¹åº”çš„å·¦å³ç«¯ç‚¹å°±éƒ½æ˜¯ï¼š
2 4
è¿™æ ·æ²¡æ¯›ç—…ï¼Œå†[2,4]ä¸Šç¡®å®5æ˜¯æœ€å¤§å€¼ï¼Œä½†æ˜¯å½“ä½ ç®—å­åŒºé—´æœ€å€¼ä¹‹å’Œæ—¶å°±ä¼šé‡å¤ï¼Œä»¥ç¬¬ä¸€ä¸ª5ä¸ºæœ€å€¼çš„å­åŒºé—´æœ‰ï¼š[2,2]ã€[2,3]ã€[2,4]ï¼Œè€Œç®—ç¬¬äºŒä¸ª5æ—¶ï¼š[2,3]ã€[3,4]ã€[2,4]ã€[3,3]ï¼Œå¾ˆæ˜æ˜¾[2,3]ã€[2,4]è¿™ä¿©åŒºé—´é‡å¤äº†ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠå®ƒä»¬å‡å»ï¼Œå¦‚ä½•å‡å»å‘¢ï¼Ÿå…¶å®åªè¦æŠŠå¤§äºç­‰äºæ”¹æˆå¤§äºå°±è¡Œäº†ï¼Œè¿™æ ·5çš„å³ç«¯ç‚¹å°±æ‹“å±•åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äº5çš„å‰ä¸€ä¸ªä½ç½®ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ª5åŒºé—´å˜æˆäº†[2,2]ï¼Œå°±å®Œæˆäº†å»é‡
### CODE
```
#include<iostream>
#include<cstdio>
#include<set>
#include<cmath>
#include<cstring>
#include<string>
#include<map>
#include<vector>
#include<queue>
#include<stack>
#include<algorithm>
#define ios ios::sync_with_stdio(0); cin.tie(0); cout.tie(0)
typedef long long ll;
using namespace std;
const int MAXN=1e5+100;
ll l[MAXN],r[MAXN],a[MAXN]; 
ll fun(ll n){
	stack<ll> st1,st2;
	memset(l,0,sizeof l);
	memset(r,0,sizeof r);
	for(ll i=1;i<=n;i++){
		while(st1.size()&&a[i]>=a[st1.top()]){
			st1.pop();
		}
		if(st1.empty()) l[i]=1;
		else l[i]=st1.top()+1;
		st1.push(i);
	}
	for(ll i=n;i;i--){
		while(st2.size()&&a[i]>a[st2.top()]){ //ä¸€å®šæ³¨æ„è¿™é‡Œæ˜¯å¤§äºå·
			st2.pop();
		}
		if(st2.empty()) r[i]=n;
		else r[i]=st2.top()-1;
		st2.push(i);
	}
	ll ans=0;
	for(ll i=1;i<=n;i++){
		ans+=a[i]*((r[i]-l[i])+(i-l[i])*(r[i]-i));
	}
	return ans;
}
int main()
{
	ios;
	ll t;
	cin>>t;
	while(t--){
		ll n; cin>>n;
		for(ll i=1;i<=n;i++) cin>>a[i];
		ll ans=0;
		ans+=fun(n);
		for(ll i=1;i<=n;i++) a[i]=-a[i];
		ans+=fun(n);
		cout<<ans<<'\n';
	}
	return 0;
}
```